# 数值分析实验 - 插值与曲线拟合

本项目实现了牛顿插值算法和最小二乘拟合方法，研究龙格现象、节点选择策略以及鲁棒拟合算法。

## 📁 项目结构

```
NA-lab2/
├── core/                          # 核心算法模块
│   ├── matrix.py                  # 矩阵运算（手工实现）
│   ├── interpolation.py           # 牛顿插值算法
│   ├── fitting.py                 # 最小二乘拟合
│   └── ransac.py                  # RANSAC鲁棒拟合
│
├── utils/                         # 工具模块
│   ├── sampling.py                # 采样策略（随机、切比雪夫、勒让德）
│   ├── metrics.py                 # 误差计算
│   ├── plotting.py                # 基础可视化
│   └── plotting_task2.py          # 任务二可视化
│
├── results/                       # 实验结果（自动生成）
│   ├── task1/                     # 任务一：插值结果
│   └── task2/                     # 任务二：拟合结果
│
├── task1_interpolation.py         # 任务一主程序
├── task2_least_squares.py         # 任务二主程序
├── generate_additional_plots.py   # 生成额外统计图表
├── clean_results.py               # 清理输出结果
├── report.tex                     # 实验报告（LaTeX）
├── requirements.txt               # 依赖列表
└── README.md                      # 本文件
```

## 🎯 实验任务

### 任务一：龙格函数插值与龙格现象分析

对龙格函数 $f(x) = \frac{1}{1+25x^2}$ 在区间 $[-1,1]$ 上进行插值：

- **三种采样策略**：随机采样、切比雪夫节点、勒让德节点
- **插值方法**：牛顿差商插值
- **采样点数**：n ∈ {5, 9, 15, 21}
- **分析重点**：龙格现象的产生与抑制

### 任务二：最小二乘法曲线拟合

对函数 $g(x) = c\sin(dx) + e\cos(fx)$ 进行拟合：

**子任务1**：扰动影响分析
- 添加不同水平的扰动（0%, 10%, 20%, 30%）
- 分析拟合鲁棒性和误差传播

**子任务2**：分段多项式拟合
- 分段数：2、4、8段
- 多项式次数：1、2、3、4次
- 生成误差矩阵并找出最优配置

**子任务3**：RANSAC鲁棒拟合
- 对比标准最小二乘与RANSAC
- 三种噪声场景：高斯噪声、离群点、混合噪声
- 分析RANSAC的适用场景

## 🚀 快速开始

### 安装依赖

```bash
pip install -r requirements.txt
```

或手动安装：
```bash
pip install matplotlib numpy
```

> **注意**：`numpy`仅用于获取勒让德多项式零点，所有核心算法均手工实现。

### 运行实验

```bash
# 任务一：龙格函数插值
python task1_interpolation.py

# 任务二：最小二乘法拟合
python task2_least_squares.py

# 生成额外的统计图表
python generate_additional_plots.py

# 清理所有输出结果
python clean_results.py
```

### 输出结果

**任务一**：
- `results/task1/` - 插值对比图、龙格现象图
- `results/task1/additional/` - 误差分布、箱线图、收敛曲线

**任务二**：
- `results/task2/subtask1/` - 扰动影响分析图
- `results/task2/subtask2/` - 分段拟合对比图、误差热力图
- `results/task2/subtask3/` - RANSAC对比图
- `results/task2/additional/` - 残差分析、系数误差分析

## 🔧 技术约束

### ✅ 允许使用
- `matplotlib` - 可视化
- `numpy.polynomial.legendre` - **仅**用于获取勒让德零点
- `math`、`random` - 基础数学函数

### ❌ 禁止使用
- `numpy` - 数组操作、矩阵运算
- `scipy` - 插值、优化
- `sklearn` - 机器学习

### 🛠️ 手工实现
- ✓ 矩阵运算（加法、乘法、转置、求逆）
- ✓ 高斯消元法（列主元）
- ✓ 牛顿差商插值
- ✓ 最小二乘法（法方程）
- ✓ 分段多项式拟合
- ✓ RANSAC算法
- ✓ 切比雪夫节点计算

## 📊 核心算法

### 牛顿插值

```python
# 差商递推公式
f[x_i, ..., x_j] = (f[x_{i+1},...,x_j] - f[x_i,...,x_{j-1}]) / (x_j - x_i)

# 插值多项式（霍纳形式）
P(x) = f[x_0] + (x-x_0)[f[x_0,x_1] + (x-x_1)[...]]
```

### 最小二乘法

```python
# 法方程
A^T A c = A^T y

# 求解
c = (A^T A)^{-1} A^T y
```

### RANSAC算法

```
1. 随机选择最小样本集
2. 拟合模型
3. 计算残差，统计内点
4. 保留最佳模型
5. 用所有内点重新拟合
```

## 📈 实验结果

### 龙格现象量化

| 方法 | n=5 | n=9 | n=15 | n=21 |
|------|-----|-----|------|------|
| 随机采样 | 3.13 | 10.29 | 286.52 | **12218.15** |
| 切比雪夫 | 0.58 | 0.51 | 0.61 | 0.63 |
| 勒让德 | 0.80 | 0.82 | 0.92 | 0.99 |

> 边界/中心误差比：随机采样呈指数级增长，切比雪夫/勒让德节点保持稳定。

### 分段拟合最优配置

| 分段数 | 1次 | 2次 | 3次 | 4次 |
|--------|-----|-----|-----|-----|
| 2段 | 1.3466 | 0.8408 | 0.4584 | 0.1888 |
| 4段 | 0.5639 | 0.1893 | 0.0484 | 0.0100 |
| 8段 | 0.1628 | 0.0319 | 0.0037 | **0.0006** |

> 最佳配置：8分段 + 4次多项式（RMSE = 6.5×10⁻⁴）

### RANSAC性能

| 噪声类型 | 标准LS | RANSAC | 改善率 |
|----------|--------|--------|--------|
| 高斯噪声 | 0.3165 | 0.7930 | -150% |
| 离群点 | 1.2978 | 0.0112 | **+99%** |
| 混合噪声 | 1.6654 | 0.2530 | **+85%** |

> RANSAC在离群点场景下表现卓越，但不适合全局噪声。

## ⚙️ 参数配置

### 任务一参数（task1_interpolation.py）

```python
interval = [-1, 1]              # 插值区间
sample_sizes = [5, 9, 15, 21]   # 采样点数
n_dense = 1000                  # 评估点数
random_seed = 42                # 随机种子
```

### 任务二参数（task2_least_squares.py）

```python
c, d, e, f = 2.0, 1.5, 1.5, 2.5  # 目标函数参数
n = 80                            # 采样点数 (总共81点)
perturbation_levels = [0.10, 0.20, 0.30]  # 扰动水平
segments = [2, 4, 8]              # 分段数
degrees = [1, 2, 3, 4]            # 多项式次数
```

## 📝 实验报告

LaTeX报告位于 `report.tex`，包含：
- 完整的理论推导和公式
- 详细的实验结果和可视化
- 18张专业图表（插值对比、误差分布、收敛分析、残差分析等）
- 核心算法代码实现

编译报告（需要LaTeX环境）：
```bash
xelatex report.tex
xelatex report.tex  # 再次编译以生成目录
```

## ⚠️ 注意事项

- **运行时间**：任务一约1-3分钟，任务二约3-5分钟
- **数值稳定性**：已实现列主元选择，但对病态矩阵可能不稳定
- **随机性**：使用固定种子（42）保证结果可复现
- **Python版本**：建议使用Python 3.8+

## 📚 模块说明

| 模块 | 功能 | 关键算法 |
|------|------|----------|
| `core/matrix.py` | 矩阵运算 | 高斯消元、矩阵乘法、求逆 |
| `core/interpolation.py` | 插值算法 | 牛顿差商、霍纳法则 |
| `core/fitting.py` | 曲线拟合 | 最小二乘、分段拟合 |
| `core/ransac.py` | 鲁棒拟合 | RANSAC迭代、内点检测 |
| `utils/sampling.py` | 采样策略 | 切比雪夫节点、勒让德节点 |
| `utils/metrics.py` | 误差计算 | Max Error, RMSE, MAE |
| `utils/plotting*.py` | 可视化 | matplotlib图表生成 |

## 🎓 学习要点

1. **龙格现象**：等距节点高次插值的危害及切比雪夫/勒让德节点的优势
2. **数值稳定性**：列主元选取对高斯消元的重要性
3. **过拟合控制**：分段拟合中分段数与多项式次数的平衡
4. **鲁棒方法**：RANSAC适用于稀疏离群点，不适合全局噪声
5. **算法实现**：手工实现加深对数值算法的理解

## 📄 许可

本项目仅用于数值分析课程教学目的。

---

**数值分析课程实验2** - 插值与曲线拟合方法的实现与分析
